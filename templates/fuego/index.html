<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recomendador de Prevención de Incendios</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Arial', sans-serif;
        }

        h1 {
            margin-top: 30px;
            font-size: 2.5rem;
        }

        .container {
            max-width: 800px;
        }

        #loader {
            display: none;
            border: 6px solid #f3f3f3;
            border-radius: 50%;
            border-top: 6px solid #3498db;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        #resultado {
            display: none;
        }

        .explanation {
            font-size: 1.1rem;
            margin-bottom: 30px;
            color: #666;
            text-align: justify;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 class="text-center my-4">Recomendador de Prevención de Incendios</h1>
        <div class="explanation">
            Este sistema utiliza datos geográficos, climáticos y un conjunto de datos históricos de incendios en Chile para proporcionar las mejores prácticas de prevención de incendios en tu área. Utiliza la ubicación de tu navegador para identificar tu posición y combinar esta información con datos climáticos actuales como temperatura, humedad y velocidad del viento. Además, se consulta un registro histórico de incendios forestales para identificar zonas vulnerables y patrones de incendios pasados. Finalmente, un algoritmo de inteligencia artificial, OpenAI, analiza todos estos factores y genera recomendaciones personalizadas para reducir el riesgo de incendios.
        </div>
        <div class="text-center">
            <button class="btn btn-primary" id="obtener-recomendacion">Obtener Recomendación</button>
        </div>

        <!-- Loader que se muestra mientras se obtiene la recomendación -->
        <div id="loader" class="text-center"></div>

        <div id="resultado" class="mt-5"></div>
        <div id="mapa" class="mt-3"></div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var boton = document.getElementById("obtener-recomendacion");
            var loader = document.getElementById("loader");
            var resultado = document.getElementById("resultado");
            var mapa = document.getElementById("mapa");

            boton.addEventListener("click", function () {
                // Mostrar el loader mientras se procesa la solicitud
                loader.style.display = "block";
                resultado.style.display = "none";
                mapa.innerHTML = "";

                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function (position) {
                        var lat = position.coords.latitude;
                        var lon = position.coords.longitude;

                        fetch('/fuego/recommendacion', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                lat: lat,
                                lon: lon
                            }),
                        })
                            .then(response => response.json())
                            .then(data => {
                                // Ocultar el loader
                                loader.style.display = "none";
                                resultado.style.display = "block";

                                // Mostrar la recomendación
                                resultado.innerHTML = `<h3>Recomendación:</h3><p>${data.recomendacion}</p>`;

                                // Mostrar el mapa si está disponible
                                if (data.mapa_url) {
                                    mapa.innerHTML = `<iframe src="${data.mapa_url}" width="100%" height="500px"></iframe>`;
                                }
                            })
                            .catch(error => {
                                loader.style.display = "none";
                                alert('Error al obtener la recomendación: ' + error);
                            });
                    }, function (error) {
                        loader.style.display = "none";
                        alert('Error al obtener la ubicación: ' + error.message);
                    });
                } else {
                    loader.style.display = "none";
                    alert("La geolocalización no es soportada por este navegador.");
                }
            });
        });
    </script>

</body>

</html>
